const imagesToAnimate=[...document.querySelectorAll(".not-animated")],controlButtons=[...document.querySelectorAll(".button-control")],nextButton=controlButtons.find(e=>e.classList.contains("skip-forward-button")),previousButton=controlButtons.find(e=>e.classList.contains("skip-backward-button")),repeatButton=controlButtons.find(e=>e.classList.contains("repeat-button")),randomButton=controlButtons.find(e=>e.classList.contains("random-button")),volumeIcon=document.querySelector(".toggle-volume"),player={};player.$container=document.querySelector(".controls-player"),player.$imagesContainer=document.querySelector(".images-container"),player.$musicName=player.$container.querySelector(".title"),player.$artistName=player.$container.querySelector(".author-album"),player.$bioImage=player.$imagesContainer.querySelector(".bio-image"),player.$mainImage=player.$imagesContainer.querySelector(".main-image"),player.$albumImage=player.$container.querySelector(".album-image"),player.$albumImageUri=player.$container.querySelector(".main-color-base-image"),player.$audio=document.querySelector("audio"),player.$play=player.$container.querySelector(".play-button"),player.$seekVolume=player.$container.querySelector(".seek-bar-volume"),player.$seekTime=player.$container.querySelector(".seek-bar-time"),player.$spanCurrentTime=player.$container.querySelector(".current-time"),player.$spanDuration=player.$container.querySelector(".duration"),player.$fillTime=player.$seekTime.querySelector(".fill-time"),player.$fillTimeDot=player.$seekTime.querySelector(".dot-seek-bar-time"),player.$fillVolume=player.$seekVolume.querySelector(".fill-volume"),player.$fillVolumeDot=player.$seekVolume.querySelector(".dot-seek-bar-volume"),player.$lyricsOrigin=document.querySelector("track"),player.$lyricsSpan=document.querySelector(".first-lyric");let seekTimeWidth=player.$seekTime.offsetWidth,seekVolumeWidth=player.$seekVolume.offsetWidth;const localMusicPositionTime=localStorage.getItem("localMusicPositionTime"),localMusicVolume=localStorage.getItem("localMusicVolume"),localMusicNumber=localStorage.getItem("localMusicNumber");let playlistDatabase,localMusicMode=localStorage.getItem("localMusicMode"),localMusicRandom=localStorage.getItem("localMusicRandom"),localIndexRandomMusic=localStorage.getItem("localIndexRandomMusic"),randomMusicNumbersArray=[],musicNumber=0;window.fetch("./database/player_database.json").then(e=>e.json()).then(e=>{playlistDatabase=e,localIndexRandomMusic&&"random"==localMusicRandom?(randomButton.classList.replace("is-not-active","is-active"),randomMusicPlaylist(),musicNumber=randomMusicNumbersArray[localIndexRandomMusic]):"random"!=localMusicRandom||localIndexRandomMusic?musicNumber=localMusicNumber||0:(localIndexRandomMusic=0,randomButton.classList.replace("is-not-active","is-active"),randomMusicPlaylist(),musicNumber=randomMusicNumbersArray[localIndexRandomMusic]),changeMusic()}).catch(e=>{console.log(e)}),window.addEventListener("resize",()=>{for(const e of imagesToAnimate)e.classList.add("loading");seekTimeWidth=player.$seekTime.offsetWidth,seekVolumeWidth=player.$seekVolume.offsetWidth,simpleUpdateSeekBar(),simpleUpdateVolume()}),window.addEventListener("load",()=>{localMusicPositionTime>0&&(player.$audio.currentTime=localMusicPositionTime,simpleUpdateSeekBar()),player.$audio.volume=localMusicVolume||1,simpleUpdateVolume(),localMusicPlayMode()});const nextMusicChanger=()=>{"random"==localMusicRandom?(localIndexRandomMusic<randomMusicNumbersArray.length-1?localIndexRandomMusic++:localIndexRandomMusic=0,musicNumber=randomMusicNumbersArray[localIndexRandomMusic],localStorage.setItem("localIndexRandomMusic",localIndexRandomMusic)):musicNumber==playlistDatabase.length-1?musicNumber=0:musicNumber++,imagesChange("animated-next",2e3),changeMusic(),localStorage.setItem("localMusicNumber",musicNumber),player.$audio.currentTime=0,simpleUpdateSeekBar(),player.$lyricsSpan.innerHTML="",player.$audio.play(),player.$play.classList.replace("is-not-active","is-active")};nextButton.addEventListener("click",()=>{nextMusicChanger()});const previousMusicChanger=()=>{player.$audio.currentTime>5?(player.$audio.currentTime=0,player.$audio.play(),simpleUpdateSeekBar()):"random"==localMusicRandom?(0==localIndexRandomMusic?localIndexRandomMusic=randomMusicNumbersArray.length-1:localIndexRandomMusic--,musicNumber=randomMusicNumbersArray[localIndexRandomMusic],localStorage.setItem("localIndexRandomMusic",localIndexRandomMusic),imagesChange("animated-previous",2e3),changeMusic()):(0==musicNumber?musicNumber=playlistDatabase.length-1:musicNumber--,imagesChange("animated-previous",2e3),changeMusic(),player.$audio.play(),player.$play.classList.replace("is-not-active","is-active")),player.$lyricsSpan.innerHTML="",localStorage.setItem("localMusicNumber",musicNumber)};previousButton.addEventListener("click",()=>{previousMusicChanger()});const playMusic=()=>{player.$play.classList.contains("is-not-active")?(document.title=`${playlistDatabase[musicNumber].musicName} - ${playlistDatabase[musicNumber].artist}`,player.$audio.play().then(e=>{mediaSessionUpdate()}).catch(e=>{console.log(e)}),player.$play.classList.replace("is-not-active","is-active")):(player.$audio.pause(),player.$play.classList.replace("is-active","is-not-active"),document.title="Plic - Music Player")};player.$play.addEventListener("click",()=>{playMusic()});const imagesChange=(e,a)=>{for(const t of imagesToAnimate)t.classList.contains("loading")&&t.classList.remove("loading"),t.classList.replace("not-animated",e),setTimeout(()=>{t.classList.replace(e,"not-animated")},a)},changeMusic=()=>{player.$audio.pause(),musicNumber>playlistDatabase.length-1&&(musicNumber=0),musicInformationChanger(),setTimeout(()=>{player.$musicName.textContent=playlistDatabase[musicNumber].musicName,player.$artistName.textContent=playlistDatabase[musicNumber].artist},500),player.$albumImageUri.src=playlistDatabase[musicNumber].albumCoverDataURi,player.$audio.src=playlistDatabase[musicNumber].audioSrc,player.$lyricsOrigin.src=playlistDatabase[musicNumber].lyrics,player.$audio.addEventListener("loadedmetadata",()=>{player.$spanCurrentTime.textContent=`${Math.floor(player.$audio.currentTime/60)}:${leadingZeroTime(player.$audio.currentTime%60)}`,player.$spanDuration.textContent=`${Math.floor(player.$audio.duration/60)}:${leadingZeroTime(player.$audio.duration%60)}`,player.$audio.paused||(document.title=`${playlistDatabase[musicNumber].musicName} - ${playlistDatabase[musicNumber].artist}`)}),player.$albumImageUri.addEventListener("load",()=>{mainColorDef(),simpleUpdateSeekBar()}),setTimeout(()=>{player.$mainImage.style.backgroundImage=`url("${playlistDatabase[musicNumber].backgroundImage}")`,player.$bioImage.style.backgroundImage=`url("${playlistDatabase[musicNumber].bioImage}")`,player.$albumImage.style.backgroundImage=`url("${playlistDatabase[musicNumber].albumCover}")`},1e3),mediaSessionUpdate(),localStorage.setItem("localMusicNumber",musicNumber)},musicInformationChanger=()=>{player.$artistName.classList.replace("animated-music-information","not-animated-music-information"),player.$musicName.classList.replace("animated-music-information","not-animated-music-information"),setTimeout(()=>{player.$artistName.classList.replace("not-animated-music-information","animated-music-information"),player.$musicName.classList.replace("not-animated-music-information","animated-music-information")},500)},leadingZeroTime=e=>{return e<10?`0${Math.floor(e)}`:Math.floor(e)},loopSeekBarTime=()=>{if(window.requestAnimationFrame(loopSeekBarTime),!player.$audio.paused){const e=player.$audio.currentTime/player.$audio.duration,a=player.$audio.currentTime/player.$audio.duration*seekTimeWidth;player.$fillTime.style.transform=`scaleX(${e})`,player.$fillTimeDot.style.transform=`translateX(${a}px)`,player.$spanCurrentTime.textContent=`${Math.floor(player.$audio.currentTime/60)}:${leadingZeroTime(player.$audio.currentTime%60)}`,localStorage.setItem("localMusicPositionTime",player.$audio.currentTime)}player.$audio.currentTime==player.$audio.duration&&"no-loop"==localMusicMode&&(player.$play.classList.replace("is-active","is-not-active"),player.$audio.pause())};loopSeekBarTime();const updateSeekBar=e=>{if("touchmove"==e.type||"touchstart"==e.type||"touchend"==e.type)a=e.changedTouches[0].clientX;else var a=e.clientX;const t=player.$seekTime.getBoundingClientRect(),l=(a-t.left)/t.width*player.$audio.duration;if(player.$audio.currentTime=l,player.$play.classList.contains("is-active"))player.$audio.play();else{const e=player.$audio.currentTime/player.$audio.duration,a=e*seekTimeWidth;player.$fillTime.style.transform=`scaleX(${e})`,player.$fillTimeDot.style.transform=`translateX(${a}px)`}localStorage.setItem("localMusicPositionTime",player.$audio.currentTime),player.$spanCurrentTime.textContent=`${Math.floor(player.$audio.currentTime/60)}:${leadingZeroTime(player.$audio.currentTime%60)}`},simpleUpdateSeekBar=()=>{const e=player.$audio.currentTime/player.$audio.duration,a=player.$audio.currentTime/player.$audio.duration*seekTimeWidth;player.$fillTime.style.transform=`scaleX(${e})`,player.$fillTimeDot.style.transform=`translateX(${a}px)`},holdAndDragTime=e=>{e.preventDefault(),document.addEventListener("mousemove",updateSeekBar),document.addEventListener("mouseup",()=>{player.$play.classList.contains("is-active")&&player.$audio.play(),document.removeEventListener("mousemove",updateSeekBar)})},holdAndDragTimeMobile=e=>{e.preventDefault(),document.addEventListener("touchmove",updateSeekBar),document.addEventListener("touchend",()=>{player.$play.classList.contains("is-active")&&player.$audio.play(),document.removeEventListener("touchmove",updateSeekBar)})};player.$seekTime.addEventListener("mousedown",e=>{player.$audio.pause(),updateSeekBar(e),holdAndDragTime(e)}),player.$seekTime.addEventListener("touchstart",e=>{player.$audio.pause(),updateSeekBar(e),holdAndDragTimeMobile(e)}),player.$fillTimeDot.addEventListener("mousedown",e=>{holdAndDragTime(e)}),player.$fillTimeDot.addEventListener("touchstart",e=>{holdAndDragTimeMobile(e)});const volumeIconChanger=e=>{e<=0?volumeIcon.setAttribute("id","is-not-active"):e>0&&e<.33?volumeIcon.setAttribute("id","low-volume"):e>.33&&e<.66?volumeIcon.setAttribute("id","middle-volume"):e>.66&&e<=1&&volumeIcon.setAttribute("id","high-volume")},updateVolumeBar=e=>{if("touchmove"==e.type||"touchstart"==e.type||"touchend"==e.type)a=e.changedTouches[0].clientX;else var a=e.clientX;const t=player.$seekVolume.getBoundingClientRect(),l=(a-t.left)/t.width;l>=0&&l<=1?player.$audio.volume=l:l>=1?player.$audio.volume=1:l<0&&(player.$audio.volume=0),volumeIconChanger(l);const o=player.$audio.volume,i=player.$audio.volume*seekVolumeWidth;player.$fillVolume.style.transform=`scaleX(${o})`,player.$fillVolumeDot.style.transform=`translateX(${i}px)`,localStorage.setItem("localMusicVolume",player.$audio.volume)},simpleUpdateVolume=()=>{volumeIconChanger(player.$audio.volume);const e=player.$audio.volume,a=player.$audio.volume*seekVolumeWidth;player.$fillVolume.style.transform=`scaleX(${e})`,player.$fillVolumeDot.style.transform=`translateX(${a}px)`},holdAndDragVolume=e=>{e.preventDefault(),document.addEventListener("mousemove",updateVolumeBar),document.addEventListener("mouseup",()=>{document.removeEventListener("mousemove",updateVolumeBar)})},holdAndDragVolumeMobile=e=>{e.preventDefault(),document.addEventListener("touchmove",updateVolumeBar),document.addEventListener("touchend",()=>{document.removeEventListener("touchmove",updateVolumeBar)})};player.$seekVolume.addEventListener("mousedown",e=>{updateVolumeBar(e),holdAndDragVolume(e)}),player.$seekVolume.addEventListener("touchstart",e=>{updateVolumeBar(e),holdAndDragVolumeMobile(e)}),player.$fillVolumeDot.addEventListener("mousedown",e=>{holdAndDragVolume(e)}),player.$fillVolumeDot.addEventListener("touchstart",e=>{holdAndDragVolumeMobile(e)});let tempVolume;volumeIcon.addEventListener("click",()=>{player.$audio.volume>0?(tempVolume=player.$audio.volume,player.$audio.volume=0):player.$audio.volume=tempVolume,simpleUpdateVolume()});const localMusicPlayMode=()=>{localMusicMode?"playlist-loop"==localMusicMode?repeatButton.classList.replace("is-not-active","playlist-loop"):"music-loop"==localMusicMode&&repeatButton.classList.replace("is-not-active","music-loop"):localMusicMode="no-loop"},musicPlayMode=()=>{repeatButton.classList.contains("is-not-active")?(repeatButton.classList.replace("is-not-active","playlist-loop"),localMusicMode="playlist-loop",localStorage.setItem("localMusicMode",localMusicMode)):repeatButton.classList.contains("playlist-loop")?(repeatButton.classList.replace("playlist-loop","music-loop"),localMusicMode="music-loop",localStorage.setItem("localMusicMode",localMusicMode)):(repeatButton.classList.replace("music-loop","is-not-active"),localMusicMode="no-loop",localStorage.setItem("localMusicMode",localMusicMode))};repeatButton.addEventListener("click",()=>{musicPlayMode()});const randomMusicPlaylist=()=>{let e=localStorage.getItem("localMusicNumbersArray");if(e)randomMusicNumbersArray=JSON.parse(e);else if(localIndexRandomMusic=0,0==randomMusicNumbersArray.length||!randomMusicNumbersArray){for(playlistDatabaseElement of playlistDatabase){let e=Math.floor(Math.random()*Math.floor(playlistDatabase.length));for(;-1!=randomMusicNumbersArray.indexOf(e);)e=Math.floor(Math.random()*Math.floor(playlistDatabase.length));randomMusicNumbersArray.push(e)}localStorage.setItem("localMusicNumbersArray",JSON.stringify(randomMusicNumbersArray))}};randomButton.addEventListener("click",()=>{randomButton.classList.contains("is-not-active")?(randomButton.classList.replace("is-not-active","is-active"),localMusicRandom="random",randomMusicPlaylist()):randomButton.classList.contains("is-active")&&(randomButton.classList.replace("is-active","is-not-active"),localMusicRandom="no-random",localStorage.removeItem("localMusicNumbersArray"),localStorage.removeItem("localIndexRandomMusic"),randomMusicNumbersArray=[]),localStorage.setItem("localMusicRandom",localMusicRandom)}),player.$audio.addEventListener("ended",()=>{if("random"==localMusicRandom){if(!e)var e=0;musicNumber=randomMusicNumbersArray[e],"playlist-loop"==localMusicMode?(e<randomMusicNumbersArray.length-1?e++:e=0,nextMusicChanger()):"music-loop"==localMusicMode?(player.$audio.loop=!0,player.$audio.play()):"no-loop"==localMusicMode&&(player.$audio.loop=!1,player.$audio.currentTime=0,playMusic(),simpleUpdateSeekBar())}else"playlist-loop"==localMusicMode?nextMusicChanger():"music-loop"==localMusicMode?(player.$audio.loop=!0,player.$audio.play()):"no-loop"==localMusicMode&&(player.$audio.loop=!1,player.$audio.currentTime=0,playMusic(),simpleUpdateSeekBar())});const mainColorDef=()=>{const e={};e.$block=5,e.$canvas=document.createElement("canvas"),e.$context=e.$canvas.getContext("2d"),e.$baseImage=document.querySelector(".main-color-base-image"),e.$dataImage,e.$width=e.$baseImage.width,e.$height=e.$baseImage.height;let a={};a.r=0,a.g=0,a.b=0;let t={};t.r=0,t.g=0,t.b=0;let l=0,o=0;for(e.$context.drawImage(e.$baseImage,0,0),e.$dataImage=e.$context.getImageData(0,0,e.$width,e.$height);(l+=4*e.$block)<e.$dataImage.data.length;)o++,a.r+=e.$dataImage.data[l],a.g+=e.$dataImage.data[l+1],a.b+=e.$dataImage.data[l+2];a.r=Math.abs(Math.floor(a.r/o)),a.g=Math.abs(Math.floor(a.g/o)),a.b=Math.abs(Math.floor(a.b/o)),a.r+a.g+a.b<=105?(t.r=Math.abs(a.r+20),t.g=Math.abs(a.g+20),t.b=Math.abs(a.b+20)):(t.r=Math.abs(a.r-20),t.g=Math.abs(a.g-20),t.b=Math.abs(a.b-20)),document.documentElement.style.setProperty("--main-album-color",`rgb(${a.r},${a.g},${a.b})`),document.documentElement.style.setProperty("--darker-main-album-color",`rgb(${t.r},${t.g},${t.b})`)};let track=player.$audio.textTracks[0];track.mode="hidden";const lyricsChanger=()=>{track.addEventListener("cuechange",()=>{if(track.activeCues[0]){let e=track.activeCues[0].text;player.$lyricsSpan.classList.replace("show-lyric","hide-lyric"),setTimeout(()=>{player.$lyricsSpan.innerHTML=e,player.$lyricsSpan.classList.replace("hide-lyric","show-lyric")},100)}})};lyricsChanger();const mediaSessionUpdate=()=>{"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:`${playlistDatabase[musicNumber].musicName}`,artist:`${playlistDatabase[musicNumber].artist}`,artwork:[{src:playlistDatabase[musicNumber].albumCover,sizes:"96x96",type:"image/jpg"},{src:playlistDatabase[musicNumber].albumCover,sizes:"128x128",type:"image/jpg"},{src:playlistDatabase[musicNumber].albumCover,sizes:"192x192",type:"image/jpg"},{src:playlistDatabase[musicNumber].albumCover,sizes:"256x256",type:"image/jpg"},{src:playlistDatabase[musicNumber].albumCover,sizes:"384x384",type:"image/jpg"},{src:playlistDatabase[musicNumber].albumCover,sizes:"512x512",type:"image/jpg"}]}),navigator.mediaSession.setActionHandler("play",()=>playMusic()),navigator.mediaSession.setActionHandler("pause",()=>playMusic()),navigator.mediaSession.setActionHandler("previoustrack",()=>previousMusicChanger()),navigator.mediaSession.setActionHandler("nexttrack",()=>nextMusicChanger()))};window.addEventListener("keydown",e=>{e.ctrlKey&&37==e.keyCode?previousMusicChanger():e.ctrlKey&&39==e.keyCode?nextMusicChanger():32==e.keyCode&&(e.preventDefault(),playMusic())});